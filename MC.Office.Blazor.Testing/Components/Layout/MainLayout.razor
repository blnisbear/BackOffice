@using MC.Office.Blazor.Testing.Components.Layout.Button

@inherits DrawerStateLayoutComponentBase

@inject NavigationManager NavigationManager

<div class="demo-header-container">
    <nav class="demo-header p-0 navbar navbar-dark" aria-label="Header menu">
        <ToggleButton @bind-Toggled="@LayoutToggled" />
        <div class="d-flex justify-content-center align-items-center">
            <i class="fa-solid fa-globe fs-5 me-1 icon-gradient" />
            <span class="fw-bold ms-1 fs-5 text-gradient">@GetOrgName</span>
        </div>
        <div class="demo-btn-container">
            <OrganizeButton @bind-SelectedOrganize="@currentOrganize" />

            <LanguageButton @bind-SelectedLanguage="@currentLanguage" />

            <div class="btn-sep"></div>

            <UserProfileButton OnChangePasswordClick="HandleChangePassword" OnLogoutClick="HandleLogout" />
        </div>
    </nav>
</div>

<div class="page">
    <Drawer CssClass="navigation-drawer" PanelWidth="240px" Toggled="@LayoutToggled">
        <HeaderTemplate>
            <div class="w-100 p-2">
                <MenuBarButton SelectedOrganize="@currentOrganize"
                               OnMenuSelected="OnMenuChanged" />
            </div>
        </HeaderTemplate>
        <BodyTemplate>
            <div class="w-100">
                <NavMenu SelectedMenuCategory="@selectedMenu" />
            </div>
        </BodyTemplate>
        <TargetContent>
            <div class="drawer-content">
                <div class="page-content-container">
                    @Body
                </div>
            </div>
        </TargetContent>
    </Drawer>
</div>

@code {
    private string currentOrganize = "MCIC";
    private string currentLanguage = "TH";
    private string selectedMenu = "";

    string LocalPath => new Uri(NavigationManager.Uri).LocalPath;

    bool _layoutToggled;

    bool LayoutToggled
    {
        get { return _layoutToggled; }
        set
        {
            if (_layoutToggled != value)
            {
                _layoutToggled = value;
            }
        }
    }

    protected override void OnInitialized()
    {
        selectedMenu = GetFirstMenuForOrganize(currentOrganize);
    }

    private void OnOrganizeChanged(string organize)
    {
        currentOrganize = organize;
        // ⭐ Reset menu เป็นหัวข้อแรกของ Organize ใหม่
        selectedMenu = GetFirstMenuForOrganize(organize);
        StateHasChanged();
    }

    private string GetFirstMenuForOrganize(string organize)
    {
        return organize switch
        {
            "MCIC" => "User Management",  // หัวข้อแรกของ MCIC
            "LF" => "Dashboard",          // หัวข้อแรกของ LF
            "VLP" => "Profile",           // หัวข้อแรกของ VLP
            "VN" => "Admin Panel",        // หัวข้อแรกของ VN
            _ => ""
        };
    }

    private void OnMenuChanged(string menu)
    {
        selectedMenu = menu;
        Console.WriteLine($"Selected Menu: {menu}");
        StateHasChanged(); // ⭐ เพิ่มบรรทัดนี้
    }

    private string GetDefaultMenuForOrganize(string organize)
    {
        return organize switch
        {
            "MCIC" => "User Management",
            "LF" => "Dashboard",
            "VLP" => "Profile",
            "VN" => "Admin Panel",
            _ => "User Management"
        };
    }

    private string GetOrgName => currentOrganize switch
    {
        "MCIC" => "MODERN CASS",
        "LF" => "LIFEFORD",
        "VLP" => "VALLEY PLUS",
        "VN" => "DCASH VIETNAM",
        _ => "ORGANIZE"
    };

    private void HandleChangePassword()
    {
        Console.WriteLine("Change Password clicked");
        // Navigate to change password page or show modal
        NavigationManager.NavigateTo("/change-password");
    }

    private void HandleLogout()
    {
        Console.WriteLine("Logout clicked");
        // Additional logout logic can be added here
        // Navigation to login is handled in the component
    }


}


